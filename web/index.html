<!DOCTYPE html>
<html>
  <head>
    <title>PlatypOUs GUI</title>
    
    <link
      type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
    />
        
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  
  <body>
    <div id="app" class="small-container">
      <b-jumbotron header="PlatypOUs GUI">
        <b-form>
          <b-form-input v-model="value" type="range" min="-2.0" max="2.0" step="0.1" v-on:change="twistFunc"></b-form-input>
          <div class="mt-2">Value: {{ value }}</div>
          <b-button v-on:click="twistReset">Reset</b-button>
        </b-form>
        <b-table caption-top stacked :items="items">
          <template #table-caption>Odometry</template>
        </b-table>
      </b-jumbotron>
      
    </div>
    <canvas id="canvas" width="640" height="360" style="border:1px solid #000000;"></canvas>

<!--
    <img id="image"/>
-->
    
    <script>    
      
    var socket = io();
    
    var ctx = document.getElementById('canvas').getContext('2d');
    //~ var ctx = document.getElementById('image');
    
    var img = new Image();
    
    var App = new Vue({
      el: '#app',
      data:{
        message: '',
        text: '',
        value: 0.0,
        x_pos: 0.0,
        y_pos: 0.0,
        lin_vel: 0.0,
        ang_vel: 0.0,
        items: [
          { x_pos: 0.0, y_pos: 0.0, lin_vel: 0.0, ang_vel: 0.0}
        ]
      },
      methods:{        
        twistFunc: function(){
          socket.emit('twist_message', this.value);
        },
        
        twistReset: function(){
          socket.emit('twist_message', 0.0)
          this.value = 0.0
        }
      }
    })
    
    socket.on('x_pos', function(msg) {
      App.items[0].x_pos = msg;
    });
    
    socket.on('y_pos', function(msg) {
      App.items[0].y_pos = msg;
    });
    
    socket.on('lin_vel', function(msg) {
      App.items[0].lin_vel = msg;
    });
    
    socket.on('ang_vel', function(msg) {
      App.items[0].ang_vel = msg;
    });
  
    socket.on('robot-camera', function(data) {
      img.src = 'data:image/jpeg;base64, ' + data;
      ctx.drawImage(img, 0, 0);
      console.log(data);
    });
  
    </script>
  </body>
</html>
